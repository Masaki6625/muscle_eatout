<div class="restaurantshow d-flex align-items-center" id="restaurant_show">
  <div class="container">
    <div class="row">
      <div class="col-lg-7 mx-auto text-center">
        <h1 class="text-white"><strong><%= @restaurant.shop_name %></strong> の詳細</h1>
      </div>
    </div>
  </div>
</div>


<div class="container text-center">
  <div class="row">
    <div class="col-md-3">
      <%= render 'public/restaurants/tag_search', tags: @tags %>
    </div>

    <div class="col-md-9">
      <div class="card w-55 mx-auto mt-4 shadow-lg">
        <%= image_tag @restaurant.get_image(600,600), class: "card-img-top" %>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-2">
                <%= image_tag @restaurant.user.get_profile_image(100,100), class: "mt-3 rounded-circle" %>
              </div>
              <div class="col-lg-10">
                <p class="card-text">
                  <%= @restaurant.shop_name do %>
                    <i class="fas fa-store"></i>
                  <% end %>
                </p>
                <p class="card-text">
                  <%= @restaurant.introduction %>
                </p>
                <div id="star">
                 <script>
                  let elem = document.querySelector('#star');
                    // elem.innerHTML = ""
                    let opt = {
                        starOn: "<%= asset_path('star-on.png') %>",
                        starOff: "<%= asset_path('star-off.png') %>",
                        starHalf: "<%= asset_path('star-half.png') %>",
                        //scoreName: 'restraunt[star]',
                        score: <%= @restaurant.star %>,
                        readOnly: true
                    };
                    raty(elem, opt);
                 </script>
                </div>
                <div class="row">
                  <% if @restaurant.user == current_user %>
                    <div class="col-md-5">
                      <%= link_to "削除する", restaurant_path(@restaurant), method: :delete, class: "btn btn-danger btn-md" %>
                    </div>
                    <div class="col-md-5">
                      <%= link_to "変更する", edit_restaurant_path(@restaurant.id), class: "btn btn-success btn-md" %>
                    </div>
                  <%end%>
                </div>
                <div class="row mx-auto mt-4 ">
                  <span>
                    <%= link_to user_path(@restaurant.user.id) do %>
                      <%= @restaurant.user.name %>
                    <%end%>
                  </span>
                    |
                  <span>
                    <%= @restaurant.created_at.strftime('%Y/%m/%d') %>
                  </span>
                    |
                  <span id="favorite_btn_<%= @restaurant.id %>">
                    <%= render 'public/restaurants/favorite', restaurant: @restaurant %>
                  </span>

                  <span><br>
                    <% @restaurant_tags.each do |tag| %>
                      <%= tag.name %>
                    <%end%>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <hr>
          <div class="map">
            <div id="map">
            </div>
          </div>

          <div type="text/javascript">
            <script>
               function initMap() {
                var uluru = {lat: <%= @restaurant.latitude ||= 0 %>, lng: <%= @restaurant.longitude ||= 0 %> };
                var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: uluru
                });
                var marker = new google.maps.Marker({
                  position: uluru,
                  map: map
                });
                   }
            </script>
            <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
          </div>
          <hr>
          <div class="comment card-text">
           <%= render 'public/comments/comments', restaurant: @restaurant %>
          </div>
          <hr>
          <div class="new-comment card-text">
            <%= render 'public/comments/form', restaurant: @restaurant, comment: @comment %>
          </div>
        </div>
      </div>
  </div>

  <div class="text-center mt-4 mb-5">
    <%= link_to "戻る", restaurants_path, class: "btn btn-dark btn-md" %>
  </div>
</div>


<script>
  window.addEventListener("scroll", (e) => {
    var scroll_y = window.scrollY
    if (scroll_y <= 270) {
      $('#headerNav').removeClass('border-bottom')
      $('#globalNav').removeClass('bg-white').addClass('bg-clear')
      $('#globalNav').find('.list-unstyled>a').removeClass('text-dark').addClass('text-light')
      $('#globalNavH1').removeClass('text-dark').addClass('text-light')
      $('.restaurantshow').css('height', '350px')
      $('#globalNav').find('.container-md').css('position', 'relative')
      $('#restaurant_show').css('position', 'relative').css('top', '-90px')
    } else {
      $('headerNab').addClass('border-bottom')
      $('#globalNav').removeClass('bg-clear').addClass('bg-white')
      $('#globalNav').find('.list-unstyled>a').removeClass('text-light').addClass('text-dark')
      $('#globalNavH1').removeClass('text-light').addClass('text-dark')
      $('.restaurantshow').css('height', '270px')
      $('#globalNav').find('.container-md').css('position', 'static')
      $('#restaurant_show').css('position', 'static').css('top', '0px')
    }
  })
</script>